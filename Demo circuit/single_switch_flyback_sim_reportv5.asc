Version 4
SHEET 1 5945676 13421556
WIRE 3872 -800 3056 -800
WIRE 2464 -704 1328 -704
WIRE 3056 -512 3056 -800
WIRE 3872 -512 3872 -800
WIRE 1424 -496 1424 -512
WIRE 1728 -496 1728 -512
WIRE 3360 -416 2880 -416
WIRE 1424 -400 1424 -416
WIRE 1728 -400 1728 -416
WIRE 3280 -336 2976 -336
WIRE 1328 -304 1328 -704
WIRE 2464 -304 2464 -704
WIRE 2464 -304 1328 -304
WIRE 3648 -304 3376 -304
WIRE 3200 -288 3088 -288
WIRE 3088 -256 3088 -288
WIRE 3200 -256 3200 -288
WIRE 3424 -208 3392 -208
WIRE 3504 -208 3488 -208
WIRE 3616 -208 3584 -208
WIRE 1408 -176 976 -176
WIRE 2416 -176 1680 -176
WIRE 4576 -160 3696 -160
WIRE 3088 -144 3088 -176
WIRE 3200 -144 3200 -176
WIRE 3200 -144 3088 -144
WIRE 3376 -144 3376 -304
WIRE 3648 -144 3648 -304
WIRE 3648 -144 3376 -144
WIRE 2976 -128 2976 -336
WIRE 3280 -128 3280 -336
WIRE 3280 -128 2976 -128
WIRE 5200 -128 4896 -128
WIRE 1168 -80 1056 -80
WIRE 1280 -80 1248 -80
WIRE 1568 -80 1360 -80
WIRE 1760 -80 1568 -80
WIRE 1856 -80 1840 -80
WIRE 2128 -80 1936 -80
WIRE 2480 -80 2128 -80
WIRE 3008 -80 2480 -80
WIRE 3104 -80 3088 -80
WIRE 3200 -80 3168 -80
WIRE 3392 -80 3392 -208
WIRE 3392 -80 3280 -80
WIRE 3472 -80 3392 -80
WIRE 3616 -80 3616 -208
WIRE 3616 -80 3536 -80
WIRE 3744 -80 3616 -80
WIRE 3984 -80 3744 -80
WIRE 4224 -80 3984 -80
WIRE 4384 -80 4224 -80
WIRE 4496 -80 4464 -80
WIRE 1056 -64 1056 -80
WIRE 2128 -64 2128 -80
WIRE 2128 -64 1968 -64
WIRE 2272 -64 2128 -64
WIRE 1968 -48 1968 -64
WIRE 2128 -48 2128 -64
WIRE 2272 -48 2272 -64
WIRE 4816 -48 4816 -96
WIRE 4992 -48 4816 -48
WIRE 3744 -32 3744 -80
WIRE 3984 -32 3984 -80
WIRE 4224 -32 4224 -80
WIRE 1568 0 1568 -80
WIRE 3104 0 3104 -80
WIRE 3168 0 3168 -80
WIRE 4992 0 4992 -48
WIRE 2576 32 2544 32
WIRE 2672 32 2640 32
WIRE 1968 48 1968 32
WIRE 2128 48 2128 32
WIRE 2272 48 2272 32
WIRE 2480 64 2480 -80
WIRE 2544 64 2544 32
WIRE 2544 64 2480 64
WIRE 2672 64 2672 32
WIRE 2688 64 2672 64
WIRE 2816 64 2752 64
WIRE 3984 64 3984 48
WIRE 4224 64 4224 48
WIRE 3744 80 3744 48
WIRE 4496 80 4496 -80
WIRE 976 96 976 -176
WIRE 1408 96 1408 -176
WIRE 1408 96 976 96
WIRE 3104 96 3104 80
WIRE 3104 96 2960 96
WIRE 2544 112 2544 64
WIRE 2576 112 2544 112
WIRE 2672 112 2672 64
WIRE 2672 112 2656 112
WIRE 1056 128 1056 16
WIRE 4992 128 4992 80
WIRE 1968 144 1968 128
WIRE 2128 144 2128 128
WIRE 2272 144 2272 128
WIRE 2816 144 2816 64
WIRE 2960 144 2960 96
WIRE 2960 144 2816 144
WIRE 3984 160 3984 144
WIRE 4224 160 4224 144
WIRE 3744 192 3744 160
WIRE 4992 224 4992 208
WIRE 1968 288 1968 208
WIRE 2128 288 2128 208
WIRE 2128 288 1968 288
WIRE 2272 288 2272 208
WIRE 2272 288 2128 288
WIRE 2128 320 2128 288
WIRE 2128 320 1632 320
WIRE 2816 336 2816 144
WIRE 2816 336 2752 336
WIRE 3168 336 3168 80
WIRE 3744 336 3744 256
WIRE 3744 336 3168 336
WIRE 3984 336 3984 224
WIRE 3984 336 3744 336
WIRE 4224 336 4224 224
WIRE 4224 336 3984 336
WIRE 4352 336 4224 336
WIRE 4496 336 4496 160
WIRE 4496 336 4432 336
WIRE 1632 352 1632 320
WIRE 1680 352 1680 -176
WIRE 2416 352 2416 -176
WIRE 2416 352 1680 352
WIRE 4784 368 4704 368
WIRE 4992 368 4992 304
WIRE 4992 368 4784 368
WIRE 5040 368 4992 368
WIRE 2880 400 2880 -416
WIRE 3360 400 3360 -416
WIRE 3360 400 2880 400
WIRE 3696 400 3696 -160
WIRE 4576 400 4576 -160
WIRE 4576 400 3696 400
WIRE 4784 400 4784 368
WIRE 2800 432 2608 432
WIRE 4896 432 4896 -128
WIRE 5200 432 5200 -128
WIRE 5200 432 4896 432
WIRE 2352 448 1232 448
WIRE 2016 496 1040 496
WIRE 2224 496 2016 496
WIRE 4784 512 4784 480
WIRE 1040 560 1040 496
WIRE 2016 592 2016 496
WIRE 3792 592 3664 592
WIRE 4000 592 3872 592
WIRE 4784 592 4784 576
WIRE 2752 608 2752 336
WIRE 3440 608 3360 608
WIRE 2752 624 2752 608
WIRE 3440 624 3440 608
WIRE 3456 624 3440 624
WIRE 3664 624 3664 592
WIRE 3664 624 3648 624
WIRE 1584 656 1552 656
WIRE 1856 656 1584 656
WIRE 1664 688 1616 688
WIRE 1776 688 1744 688
WIRE 2416 688 2176 688
WIRE 2704 688 2496 688
WIRE 1376 704 1376 688
WIRE 1584 720 1584 656
WIRE 1616 720 1616 688
WIRE 1616 720 1584 720
WIRE 1776 720 1776 688
WIRE 1856 720 1776 720
WIRE 3328 720 3056 720
WIRE 3456 720 3328 720
WIRE 3728 720 3728 704
WIRE 3728 720 3648 720
WIRE 1616 752 1616 720
WIRE 1664 752 1616 752
WIRE 1776 752 1776 720
WIRE 1776 752 1728 752
WIRE 3328 768 3328 720
WIRE 1600 784 1568 784
WIRE 1712 784 1600 784
WIRE 1856 784 1712 784
WIRE 1376 800 1376 784
WIRE 1600 800 1600 784
WIRE 1712 800 1712 784
WIRE 2608 800 2608 432
WIRE 2800 800 2800 432
WIRE 2800 800 2608 800
WIRE 3056 800 3056 720
WIRE 2592 816 2176 816
WIRE 3728 832 3728 720
WIRE 1856 848 1808 848
WIRE 1712 880 1712 864
WIRE 3056 896 3056 880
WIRE 3056 896 2992 896
WIRE 1600 912 1600 880
WIRE 1808 912 1808 848
WIRE 1808 912 1600 912
WIRE 2592 912 2592 816
WIRE 2752 912 2752 704
WIRE 2752 912 2592 912
WIRE 1600 928 1600 912
WIRE 3328 928 3328 848
WIRE 3728 928 3728 896
WIRE 3888 928 3728 928
WIRE 2752 992 2752 912
WIRE 2752 1024 2752 992
WIRE 3056 1040 3056 976
WIRE 3056 1136 3056 1120
WIRE 1600 1168 1600 992
WIRE 2016 1168 2016 912
WIRE 2016 1168 1600 1168
WIRE 1232 1184 1232 448
WIRE 2352 1184 2352 448
WIRE 2352 1184 1232 1184
WIRE 2016 1216 2016 1168
WIRE 2752 1232 2752 1104
FLAG 2752 1232 0
FLAG 1712 880 0
FLAG 1056 128 0
FLAG 4816 -96 Vout_plus
FLAG 5040 368 Vout_minus
FLAG 2224 496 Vcc
FLAG 1568 784 Vref
FLAG 4000 592 Vout_plus
FLAG 1376 800 0
FLAG 1376 688 5V
FLAG 1552 656 Vfb
FLAG 1424 -400 0
FLAG 1424 -512 P_in
FLAG 1728 -400 0
FLAG 1728 -512 P_out
FLAG 4784 592 0
FLAG 1568 0 V_input_circuit
FLAG 1632 352 0
FLAG 2016 1216 0
FLAG 3888 928 Vout_minus
FLAG 3328 928 0
FLAG 1040 640 0
FLAG 2592 816 sense
FLAG 2752 992 Vshunt
FLAG 2992 896 Vfb
FLAG 3056 1136 0
FLAG 3360 608 Vref
SYMBOL cap 1584 928 R0
SYMATTR InstName C1
SYMATTR Value 1.1n
SYMBOL cap 1696 800 R0
WINDOW 39 24 84 Left 2
SYMATTR SpiceLine IC=0
SYMATTR InstName C2
SYMATTR Value 220n
SYMBOL res 1584 784 R0
SYMATTR InstName R3
SYMATTR Value 15k
SYMBOL NMOS 2704 608 R0
SYMATTR InstName Q1
SYMATTR Value IRFR2607Z
SYMBOL ind2 3184 -16 M0
WINDOW 0 1 32 Right 2
WINDOW 3 -1 70 Right 2
SYMATTR InstName L1
SYMATTR Value 20.94µ
SYMATTR SpiceLine Rser=0 Rpar=0
SYMBOL ind2 3088 96 M180
WINDOW 0 -2 87 Right 2
WINDOW 3 -3 43 Right 2
SYMATTR InstName L3
SYMATTR Value 20.94µ
SYMATTR SpiceLine Rser=0 Rpar=0
SYMBOL schottky 3472 -96 M90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName D3
SYMATTR Value MBR735
SYMBOL VOLTAGE 1056 -80 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName source
SYMATTR Value {Vin}
SYMBOL PowerProducts\\LT1243 2016 752 R0
SYMATTR InstName U2
SYMBOL res 2512 672 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R5
SYMATTR Value 12
SYMBOL cap 3968 160 R0
WINDOW 39 24 84 Left 2
SYMATTR SpiceLine IC={V_cap_out}
SYMATTR InstName C8
SYMATTR Value {Cout}
SYMBOL voltage 1376 688 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value 5V
SYMBOL schottky 2752 80 M270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D4
SYMATTR Value MBRS340
SYMBOL cap 2640 16 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C3
SYMATTR Value 660n
SYMBOL res 2672 96 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R22
SYMATTR Value 330
SYMBOL voltage 4992 208 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName battery
SYMATTR Value {Vbat}
SYMBOL res 4976 112 R0
SYMATTR InstName R19
SYMATTR Value {Rbat}
SYMBOL res 3104 -96 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R8
SYMATTR Value 4.6m
SYMBOL res 3968 48 R0
SYMATTR InstName R23
SYMATTR Value {Rcout}
SYMBOL cap 4208 160 R0
WINDOW 39 24 84 Left 2
SYMATTR SpiceLine IC={V_cap_out}
SYMATTR InstName C6
SYMATTR Value {Cout}
SYMBOL res 4208 48 R0
SYMATTR InstName R24
SYMATTR Value {Rcout}
SYMBOL ind2 3104 -160 R180
WINDOW 0 36 80 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName L4
SYMATTR Value 20.94µ
SYMATTR Type ind
SYMBOL res 3184 -272 R0
SYMATTR InstName R2
SYMATTR Value 150
SYMBOL res 3296 -96 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R17
SYMATTR Value 4.6m
SYMBOL cap 2112 144 R0
WINDOW 39 24 84 Left 2
SYMATTR SpiceLine IC={Vin}
SYMATTR InstName C11
SYMATTR Value {Cout}
SYMBOL res 2112 32 R0
SYMATTR InstName R14
SYMATTR Value {Rcout}
SYMBOL cap 2256 144 R0
WINDOW 39 24 84 Left 2
SYMATTR SpiceLine IC={Vin}
SYMATTR InstName C12
SYMATTR Value {Cout}
SYMBOL res 2256 32 R0
SYMATTR InstName R27
SYMATTR Value {Rcout}
SYMBOL ind 1264 -64 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L7
SYMATTR Value 25nH
SYMBOL bv 1424 -512 R0
SYMATTR InstName B3
SYMATTR Value V=-{V(V_input_circuit)}*I(source)
SYMBOL bv 1728 -512 R0
SYMATTR InstName B4
SYMATTR Value V={Vbat}*I(battery)+{Rbat}*I(battery)*I(battery)+{Rbat_0}*I(battery)*I(battery)
SYMBOL cap 3488 -224 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C13
SYMATTR Value 1nF
SYMBOL res 3600 -224 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R28
SYMATTR Value 43
SYMBOL cap 1952 144 R0
SYMATTR InstName C14
SYMATTR Value 220n
SYMBOL res 1952 32 R0
SYMATTR InstName R31
SYMATTR Value 0.05
SYMBOL cap 3728 192 R0
SYMATTR InstName C16
SYMATTR Value 100n
SYMBOL res 3728 64 R0
SYMATTR InstName R32
SYMATTR Value 0.05
SYMBOL ind 3728 -48 R0
SYMATTR InstName L13
SYMATTR Value {ESL_cer}
SYMBOL res 1264 -96 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R33
SYMATTR Value 0.05
SYMBOL ind 1952 -64 R0
SYMATTR InstName L14
SYMATTR Value {ESL_cer}
SYMBOL ind 2112 -64 R0
WINDOW 3 30 64 Left 2
SYMATTR Value {ESL_elc}
SYMATTR InstName L15
SYMBOL ind 2256 -64 R0
SYMATTR InstName L16
SYMATTR Value {ESL_elc}
SYMBOL ind 3968 -48 R0
SYMATTR InstName L9
SYMATTR Value {ESL_elc}
SYMBOL ind 4208 -48 R0
SYMATTR InstName L10
SYMATTR Value {ESL_elc}
SYMBOL res 4480 -96 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R34
SYMATTR Value 2m
SYMBOL ind 1744 -64 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L11
SYMATTR Value 2.2µ
SYMBOL res 1952 -96 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R25
SYMATTR Value 2m
SYMBOL res 4480 64 R0
SYMATTR InstName R26
SYMATTR Value 10k
SYMBOL res 4976 -16 R0
SYMATTR InstName R29
SYMATTR Value {Rbat_0}
SYMBOL Optos\\PC817A 3552 672 M0
SYMATTR InstName U1
SYMBOL zener 3744 896 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D1
SYMATTR Value TDZV10
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL res 3888 576 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R4
SYMATTR Value 1.2k
SYMBOL res 3312 752 R0
SYMATTR InstName R7
SYMATTR Value 2k
SYMBOL voltage 1040 544 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName Buck_Converter
SYMATTR Value 15
SYMBOL res 2736 1008 R0
SYMATTR InstName Rsense
SYMATTR Value 65m
SYMBOL res 3040 784 R0
SYMATTR InstName R13
SYMATTR Value {2000*T_POT}
SYMBOL res 3040 880 R0
SYMATTR InstName R15
SYMATTR Value {2000*(1-T_POT)}
SYMBOL res 3040 1024 R0
SYMATTR InstName R9
SYMATTR Value 2.7k
SYMBOL cap 4768 512 R0
SYMATTR InstName C4
SYMATTR Value 1n
SYMBOL res 4768 384 R0
SYMATTR InstName R18
SYMATTR Value 1k
SYMBOL ind 4336 352 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L2
SYMATTR Value 10µ
SYMBOL res 1760 672 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R16
SYMATTR Value 10k
SYMBOL cap 1728 736 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C5
SYMATTR Value 10n
TEXT 3128 -344 Bottom 2 !K1 L1 L3 L4 0.99
TEXT 3080 -704 Left 2 !.param Cout=470u
TEXT 3080 -680 Left 2 !.param Rcout={0.064 + 3/(1+(Cout/0.00001533)**1.474)}
TEXT 1320 584 VRight 2 ;Change this with linear regulator
TEXT 3080 -656 Left 2 !.param Vbat=0
TEXT 3080 -632 Left 2 !.param Rbat={Vbat*0.004+0.000001}
TEXT 3056 -312 Left 2 ;Core loss model
TEXT 3080 -728 Left 2 !.param Vin=40
TEXT 984 -160 Left 2 ;Feeder model
TEXT 3072 -776 Left 4 ;Parameters
TEXT 1328 -824 Left 2 ;Snubber design: Lecture 8.7: The Flyback Converter 4 (RCD Snubber)\nhttps://youtu.be/WQtO3i5ZG74\nR_snubber = (Vsnubber*(Vsnubber-Vo/N)) / (0.5*(I_Lpeak^2)*L_leak*f_sw)\nC_snubber = Does not matter at steady state if ideal model is assumed. Better to pick a value resulting in <%3 ripple
TEXT 3080 -608 Left 2 !.param Rbat_0=100
TEXT 2704 448 Left 2 ;MOSFET
TEXT 1936 88 VRight 2 ;Has lower L_esr
TEXT 3840 128 VRight 2 ;Has lower L_esr
TEXT 3080 -584 Left 2 !.param ESL_cer=200p
TEXT 3080 -560 Left 2 !.param ESL_elc=10n
TEXT 2664 488 VRight 0 ;Honestly, the mosfet model already includes drain and source inductances\nI have added inductances because I could not find model of the mosfet \nWe are planning to use. This is safe and worst case scenario
TEXT 3712 -144 Left 2 ;Output filter 16V/10A rated
TEXT 1688 -160 Left 2 ;Input Filter 60V/10A rated
TEXT 1240 464 Left 2 ;CONTROLLER IC
TEXT 4464 64 VRight 1 ;discharge resistor
TEXT 3080 -536 Left 2 !.param V_cap_out={Vbat}
TEXT 4912 -112 Left 2 ;LOAD
TEXT 2520 -56 Left 2 ;Snubber
TEXT 3392 -288 Left 2 ;Diode Snubber
TEXT 2888 -400 Left 2 ;Transformer Model
TEXT 1232 1208 Left 2 !.tran 0 5m 2m uic
TEXT 3080 -512 Left 2 !.param T_POT=0.5
LINE Normal 3136 384 3136 -112 2
