Version 4
SHEET 1 5945676 13421556
WIRE 2240 -1600 1104 -1600
WIRE 1200 -1392 1200 -1408
WIRE 1504 -1392 1504 -1408
WIRE 1200 -1296 1200 -1312
WIRE 1504 -1296 1504 -1312
WIRE 1104 -1200 1104 -1600
WIRE 2240 -1200 2240 -1600
WIRE 2240 -1200 1104 -1200
WIRE 1920 -1168 1104 -1168
WIRE 1104 -880 1104 -1168
WIRE 1920 -880 1920 -1168
WIRE 3360 -416 2880 -416
WIRE 3280 -336 2976 -336
WIRE 3648 -304 3376 -304
WIRE 3200 -288 3088 -288
WIRE 3088 -256 3088 -288
WIRE 3200 -256 3200 -288
WIRE 3424 -208 3392 -208
WIRE 3504 -208 3488 -208
WIRE 3616 -208 3584 -208
WIRE 960 -176 528 -176
WIRE 1968 -176 1232 -176
WIRE 4576 -160 3696 -160
WIRE 6032 -160 5696 -160
WIRE 3088 -144 3088 -176
WIRE 3200 -144 3200 -176
WIRE 3200 -144 3088 -144
WIRE 3376 -144 3376 -304
WIRE 3648 -144 3648 -304
WIRE 3648 -144 3376 -144
WIRE 2976 -128 2976 -336
WIRE 3280 -128 3280 -336
WIRE 3280 -128 2976 -128
WIRE 720 -80 608 -80
WIRE 832 -80 800 -80
WIRE 1120 -80 912 -80
WIRE 1312 -80 1120 -80
WIRE 1408 -80 1392 -80
WIRE 1680 -80 1488 -80
WIRE 2480 -80 1680 -80
WIRE 3008 -80 2480 -80
WIRE 3104 -80 3088 -80
WIRE 3200 -80 3168 -80
WIRE 3392 -80 3392 -208
WIRE 3392 -80 3280 -80
WIRE 3472 -80 3392 -80
WIRE 3616 -80 3616 -208
WIRE 3616 -80 3536 -80
WIRE 3744 -80 3616 -80
WIRE 3984 -80 3744 -80
WIRE 4224 -80 3984 -80
WIRE 4384 -80 4224 -80
WIRE 4496 -80 4464 -80
WIRE 5616 -80 5616 -128
WIRE 5792 -80 5616 -80
WIRE 608 -64 608 -80
WIRE 1680 -64 1680 -80
WIRE 1680 -64 1520 -64
WIRE 1824 -64 1680 -64
WIRE 1520 -48 1520 -64
WIRE 1680 -48 1680 -64
WIRE 1824 -48 1824 -64
WIRE 3744 -32 3744 -80
WIRE 3984 -32 3984 -80
WIRE 4224 -32 4224 -80
WIRE 5792 -32 5792 -80
WIRE 1120 0 1120 -80
WIRE 3104 0 3104 -80
WIRE 3168 0 3168 -80
WIRE 2576 32 2544 32
WIRE 2672 32 2640 32
WIRE 1520 48 1520 32
WIRE 1680 48 1680 32
WIRE 1824 48 1824 32
WIRE 2480 64 2480 -80
WIRE 2544 64 2544 32
WIRE 2544 64 2480 64
WIRE 2672 64 2672 32
WIRE 2688 64 2672 64
WIRE 2816 64 2752 64
WIRE 3984 64 3984 48
WIRE 4224 64 4224 48
WIRE 3744 80 3744 48
WIRE 4496 80 4496 -80
WIRE 528 96 528 -176
WIRE 960 96 960 -176
WIRE 960 96 528 96
WIRE 3104 96 3104 80
WIRE 3104 96 2960 96
WIRE 5792 96 5792 48
WIRE 2544 112 2544 64
WIRE 2576 112 2544 112
WIRE 2672 112 2672 64
WIRE 2672 112 2656 112
WIRE 608 128 608 16
WIRE 1520 144 1520 128
WIRE 1680 144 1680 128
WIRE 1824 144 1824 128
WIRE 2816 144 2816 64
WIRE 2960 144 2960 96
WIRE 2960 144 2816 144
WIRE 3984 160 3984 144
WIRE 4224 160 4224 144
WIRE 3744 192 3744 160
WIRE 5792 192 5792 176
WIRE 3104 240 3104 224
WIRE 1520 288 1520 208
WIRE 1680 288 1680 208
WIRE 1680 288 1520 288
WIRE 1824 288 1824 208
WIRE 1824 288 1680 288
WIRE 1680 320 1680 288
WIRE 1680 320 1184 320
WIRE 2816 336 2816 144
WIRE 2816 336 2752 336
WIRE 3168 336 3168 80
WIRE 3744 336 3744 256
WIRE 3744 336 3168 336
WIRE 3984 336 3984 224
WIRE 3984 336 3744 336
WIRE 4224 336 4224 224
WIRE 4224 336 3984 336
WIRE 4352 336 4224 336
WIRE 4496 336 4496 160
WIRE 4496 336 4432 336
WIRE 5584 336 5504 336
WIRE 5792 336 5792 272
WIRE 5792 336 5584 336
WIRE 5840 336 5792 336
WIRE 1184 352 1184 320
WIRE 1232 352 1232 -176
WIRE 1968 352 1968 -176
WIRE 1968 352 1232 352
WIRE 5584 368 5584 336
WIRE 2880 400 2880 -416
WIRE 3360 400 3360 -416
WIRE 3360 400 2880 400
WIRE 3696 400 3696 -160
WIRE 4576 400 4576 -160
WIRE 4576 400 3696 400
WIRE 5696 400 5696 -160
WIRE 6032 400 6032 -160
WIRE 6032 400 5696 400
WIRE 2432 448 2080 448
WIRE 2352 464 1232 464
WIRE 5584 480 5584 448
WIRE 2848 496 2656 496
WIRE 2016 512 1040 512
WIRE 2224 512 2016 512
WIRE 5584 560 5584 544
WIRE 1040 576 1040 512
WIRE 2016 608 2016 512
WIRE 2752 624 2752 336
WIRE 1584 672 1552 672
WIRE 1856 672 1584 672
WIRE 1664 704 1616 704
WIRE 1776 704 1744 704
WIRE 2416 704 2176 704
WIRE 2704 704 2496 704
WIRE 1376 720 1376 704
WIRE 1584 736 1584 672
WIRE 1616 736 1616 704
WIRE 1616 736 1584 736
WIRE 1776 736 1776 704
WIRE 1856 736 1776 736
WIRE 1616 768 1616 736
WIRE 1664 768 1616 768
WIRE 1776 768 1776 736
WIRE 1776 768 1728 768
WIRE 1600 800 1568 800
WIRE 1712 800 1600 800
WIRE 1856 800 1712 800
WIRE 1376 816 1376 800
WIRE 1600 816 1600 800
WIRE 1712 816 1712 800
WIRE 2592 832 2176 832
WIRE 1856 864 1808 864
WIRE 2656 864 2656 496
WIRE 2848 864 2848 496
WIRE 2848 864 2656 864
WIRE 1712 896 1712 880
WIRE 5328 896 5200 896
WIRE 5536 896 5408 896
WIRE 4976 912 4896 912
WIRE 1600 928 1600 896
WIRE 1808 928 1808 864
WIRE 1808 928 1600 928
WIRE 2592 928 2592 832
WIRE 2752 928 2752 720
WIRE 2752 928 2592 928
WIRE 4976 928 4976 912
WIRE 4992 928 4976 928
WIRE 5200 928 5200 896
WIRE 5200 928 5184 928
WIRE 1600 944 1600 928
WIRE 2752 1008 2752 928
WIRE 4864 1024 4592 1024
WIRE 4992 1024 4864 1024
WIRE 5264 1024 5264 1008
WIRE 5264 1024 5184 1024
WIRE 2752 1040 2752 1008
WIRE 4864 1072 4864 1024
WIRE 4592 1104 4592 1024
WIRE 5264 1136 5264 1024
WIRE 1600 1184 1600 1008
WIRE 2016 1184 2016 928
WIRE 2016 1184 1600 1184
WIRE 1232 1200 1232 464
WIRE 2352 1200 2352 464
WIRE 2352 1200 1232 1200
WIRE 4592 1200 4592 1184
WIRE 4592 1200 4528 1200
WIRE 2016 1232 2016 1184
WIRE 4864 1232 4864 1152
WIRE 5264 1232 5264 1200
WIRE 5424 1232 5264 1232
WIRE 4592 1344 4592 1280
WIRE 4592 1440 4592 1424
WIRE 2752 1536 2752 1120
FLAG 2752 1536 0
FLAG 1712 896 0
FLAG 608 128 0
FLAG 5616 -128 Vout_plus
FLAG 5840 336 Vout_minus
FLAG 2224 512 Vcc
FLAG 1568 800 Vref
FLAG 5536 896 Vout_plus
FLAG 1376 816 0
FLAG 1376 704 5V
FLAG 1552 672 Vfb
FLAG 1200 -1296 0
FLAG 1200 -1408 P_in
FLAG 1504 -1296 0
FLAG 1504 -1408 P_out
FLAG 5584 560 0
FLAG 1120 0 V_input_circuit
FLAG 1184 352 0
FLAG 2016 1232 0
FLAG 5424 1232 Vout_minus
FLAG 4864 1232 0
FLAG 1040 656 0
FLAG 2592 832 sense
FLAG 2752 1008 Vshunt
FLAG 4528 1200 Vfb
FLAG 4592 1440 0
FLAG 4896 912 Vref
SYMBOL cap 1584 944 R0
SYMATTR InstName C1
SYMATTR Value 1.1n
SYMBOL cap 1696 816 R0
WINDOW 39 24 84 Left 2
SYMATTR SpiceLine IC=0
SYMATTR InstName C2
SYMATTR Value 220n
SYMBOL res 1584 800 R0
SYMATTR InstName R3
SYMATTR Value 15k
SYMBOL NMOS 2704 624 R0
SYMATTR InstName Q1
SYMATTR Value IRFR2607Z
SYMBOL ind2 3184 -16 M0
WINDOW 0 1 32 Right 2
WINDOW 3 -1 70 Right 2
SYMATTR InstName L1
SYMATTR Value 20.94µ
SYMATTR SpiceLine Rser=0 Rpar=0
SYMBOL ind2 3088 96 M180
WINDOW 0 -2 87 Right 2
WINDOW 3 -3 43 Right 2
SYMATTR InstName L3
SYMATTR Value 20.94µ
SYMATTR SpiceLine Rser=0 Rpar=0
SYMBOL schottky 3472 -96 M90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName D3
SYMATTR Value MBR735
SYMBOL VOLTAGE 608 -80 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName source
SYMATTR Value {Vin}
SYMBOL PowerProducts\\LT1243 2016 768 R0
SYMATTR InstName U2
SYMBOL res 2512 688 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R5
SYMATTR Value 12
SYMBOL cap 3968 160 R0
WINDOW 39 24 84 Left 2
SYMATTR SpiceLine IC={V_cap_out}
SYMATTR InstName C8
SYMATTR Value {Cout}
SYMBOL voltage 1376 704 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value 5V
SYMBOL schottky 2752 80 M270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D4
SYMATTR Value MBRS340
SYMBOL cap 2640 16 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C3
SYMATTR Value 4.7µ
SYMBOL res 2672 96 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R22
SYMATTR Value 134
SYMBOL voltage 5792 176 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName battery
SYMATTR Value {Vbat}
SYMBOL res 5776 80 R0
SYMATTR InstName R19
SYMATTR Value {Rbat}
SYMBOL res 3104 -96 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R8
SYMATTR Value 4.6m
SYMBOL res 3968 48 R0
SYMATTR InstName R23
SYMATTR Value {Rcout}
SYMBOL cap 4208 160 R0
WINDOW 39 24 84 Left 2
SYMATTR SpiceLine IC={V_cap_out}
SYMATTR InstName C6
SYMATTR Value {Cout}
SYMBOL res 4208 48 R0
SYMATTR InstName R24
SYMATTR Value {Rcout}
SYMBOL ind2 3104 -160 R180
WINDOW 0 36 80 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName L4
SYMATTR Value 20.94µ
SYMATTR Type ind
SYMBOL res 3184 -272 R0
SYMATTR InstName R2
SYMATTR Value 150
SYMBOL res 3296 -96 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R17
SYMATTR Value 4.6m
SYMBOL cap 1664 144 R0
WINDOW 39 24 84 Left 2
SYMATTR SpiceLine IC={Vin}
SYMATTR InstName C11
SYMATTR Value {Cout}
SYMBOL res 1664 32 R0
SYMATTR InstName R14
SYMATTR Value {Rcout}
SYMBOL cap 1808 144 R0
WINDOW 39 24 84 Left 2
SYMATTR SpiceLine IC={Vin}
SYMATTR InstName C12
SYMATTR Value {Cout}
SYMBOL res 1808 32 R0
SYMATTR InstName R27
SYMATTR Value {Rcout}
SYMBOL ind 816 -64 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L7
SYMATTR Value 25nH
SYMBOL bv 1200 -1408 R0
SYMATTR InstName B3
SYMATTR Value V=-{V(V_input_circuit)}*I(source)
SYMBOL bv 1504 -1408 R0
SYMATTR InstName B4
SYMATTR Value V={Vbat}*I(battery)+{Rbat}*I(battery)*I(battery)+{Rbat_0}*I(battery)*I(battery)
SYMBOL cap 3488 -224 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C13
SYMATTR Value 1nF
SYMBOL res 3600 -224 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R28
SYMATTR Value 43
SYMBOL cap 1504 144 R0
SYMATTR InstName C14
SYMATTR Value 220n
SYMBOL res 1504 32 R0
SYMATTR InstName R31
SYMATTR Value 0.05
SYMBOL cap 3728 192 R0
SYMATTR InstName C16
SYMATTR Value 100n
SYMBOL res 3728 64 R0
SYMATTR InstName R32
SYMATTR Value 0.05
SYMBOL ind 3728 -48 R0
SYMATTR InstName L13
SYMATTR Value {ESL_cer}
SYMBOL res 816 -96 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R33
SYMATTR Value 0.05
SYMBOL ind 1504 -64 R0
SYMATTR InstName L14
SYMATTR Value {ESL_cer}
SYMBOL ind 1664 -64 R0
WINDOW 3 30 64 Left 2
SYMATTR Value {ESL_elc}
SYMATTR InstName L15
SYMBOL ind 1808 -64 R0
SYMATTR InstName L16
SYMATTR Value {ESL_elc}
SYMBOL ind 3968 -48 R0
SYMATTR InstName L9
SYMATTR Value {ESL_elc}
SYMBOL ind 4208 -48 R0
SYMATTR InstName L10
SYMATTR Value {ESL_elc}
SYMBOL res 4480 -96 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R34
SYMATTR Value 2m
SYMBOL ind 1296 -64 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L11
SYMATTR Value 2.2µ
SYMBOL res 1504 -96 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R25
SYMATTR Value 2m
SYMBOL res 4480 64 R0
SYMATTR InstName R26
SYMATTR Value 10k
SYMBOL res 5776 -48 R0
SYMATTR InstName R29
SYMATTR Value {Rbat_0}
SYMBOL Optos\\PC817A 5088 976 M0
SYMATTR InstName U1
SYMBOL zener 5280 1200 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D1
SYMATTR Value TDZV10
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL res 5424 880 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R4
SYMATTR Value 1.2k
SYMBOL res 4848 1056 R0
SYMATTR InstName R7
SYMATTR Value 2k
SYMBOL voltage 1040 560 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value 12
SYMBOL res 2736 1024 R0
SYMATTR InstName R1
SYMATTR Value 15m
SYMBOL res 4576 1088 R0
SYMATTR InstName R13
SYMATTR Value {2000*T_POT}
SYMBOL res 4576 1184 R0
SYMATTR InstName R15
SYMATTR Value {2000*(1-T_POT)}
SYMBOL res 4576 1328 R0
SYMATTR InstName R9
SYMATTR Value 2.7k
SYMBOL cap 5568 480 R0
SYMATTR InstName C4
SYMATTR Value 1n
SYMBOL res 5568 352 R0
SYMATTR InstName R18
SYMATTR Value 1k
SYMBOL ind 4336 352 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L2
SYMATTR Value 10µ
SYMBOL res 1760 688 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R16
SYMATTR Value 10k
SYMBOL cap 1728 752 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C5
SYMATTR Value 10n
TEXT 3128 -344 Bottom 2 !K1 L1 L3 L4 0.99
TEXT 1720 592 Right 1 ;to eliminate high frequency noise.\nFB input is very high Z. spikes significantly effects
TEXT 1128 -1072 Left 2 !.param Cout=470u
TEXT 1128 -1048 Left 2 !.param Rcout={0.064 + 3/(1+(Cout/0.00001533)**1.474)}
TEXT 1320 600 VRight 2 ;Change this with linear regulator
TEXT 1128 -1024 Left 2 !.param Vbat=0
TEXT 1128 -1000 Left 2 !.param Rbat={Vbat*0.004+0.000001}
TEXT 3056 -312 Left 2 ;Core loss model
TEXT 3488 -24 Center 2 ;!HEAT!\n!BREAKDOWN!
TEXT 2552 192 Right 2 ;!HEAT!
TEXT 1128 -1096 Left 2 !.param Vin=40
TEXT 536 -160 Left 2 ;Feeder model
TEXT 2712 208 Center 1 ;!BREAKDOWN!
TEXT 1120 -1144 Left 4 ;Parameters
TEXT 1104 -1720 Left 2 ;Snubber design: Lecture 8.7: The Flyback Converter 4 (RCD Snubber)\nhttps://youtu.be/WQtO3i5ZG74\nR_snubber = (Vsnubber*(Vsnubber-Vo/N)) / (0.5*(I_Lpeak^2)*L_leak*f_sw)\nC_snubber = Does not matter at steady state if ideal model is assumed. Better to pick a value resulting in <%3 ripple
TEXT 1128 -976 Left 2 !.param Rbat_0=100
TEXT 2752 512 Left 2 ;MOSFET
TEXT 1488 88 VRight 2 ;Has lower L_esr
TEXT 3840 128 VRight 2 ;Has lower L_esr
TEXT 1128 -952 Left 2 !.param ESL_cer=200p
TEXT 1128 -928 Left 2 !.param ESL_elc=10n
TEXT 2664 504 VRight 0 ;Honestly, the mosfet model already includes drain and source inductances\nI have added inductances because I could not find model of the mosfet \nWe are planning to use. This is safe and worst case scenario
TEXT 3712 -144 Left 2 ;Output filter 16V/10A rated
TEXT 1240 -160 Left 2 ;Input Filter 60V/10A rated
TEXT 1240 480 Left 2 ;CONTROLLER IC
TEXT 4464 64 VRight 1 ;discharge resistor
TEXT 1128 -904 Left 2 !.param V_cap_out={Vbat}
TEXT 5712 -144 Left 2 ;LOAD
TEXT 2520 -56 Left 2 ;Snubber
TEXT 3392 -288 Left 2 ;Diode Snubber
TEXT 2888 -400 Left 2 ;Transformer Model
TEXT 1232 1224 Left 2 !.tran 0 5m 2m uic
TEXT 1128 -880 Left 2 !.param T_POT=0.5
LINE Normal 3136 384 3136 -112 2
